#!/bin/bash
# Script to launch the default editor on a specified diary entry and then perform a backup.

DIARY_DIRECTORY="${HOME}/.diary/data/entries"

function usage_and_exit {
	echo "Help not implemented yet."
	exit 1
}

# Work out what entry the user wants to edit.
# No arguments - edit most recent entry.
# Positive number - edit entry with that index.
# Negative number - edit entry made that number of entries ago. 
# Anything else - print usage and exit. 
entry_no=-1
[[ $# == 1 ]] && entry_no="$1"
[[ $# -gt 1 ]] && usage_and_exit
[[ "$entry_no" =~ ^(\+|-)?[0-9]+$ ]] || usage_and_exit

# If negative then list entries in reverse order.
if [[ "$entry_no" -lt 0 ]]; then 
    reverse="-r"
    let entry_no*=-1

# If positive then add one (to change to 1-based indexing). 
else
    reverse=""
    let entry_no++
fi

# Find the specified entry.
entry=$(ls $reverse -1 $DIARY_DIRECTORY | awk "FNR==$entry_no")

if [[ -z "$entry" ]]; then 
	echo "Error: entry is not available" >&2
	exit 1
fi


function use_vim {
	vim "+set spell" $file_path
}

use_vim
diary-backup > /dev/null &
