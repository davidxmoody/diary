#!/bin/bash
# Dilplays diary entries in less. 

# Process command line options. 
print=
range="-40::-1"
while true; do
    case $1 in
        -n) 
            shift
            [[ ! "$1" -gt 0 ]] && exit 1
            range="-$1::-1"
            shift
        ;;
        --number=*)
            [[ ! "${1#--number=}" -gt 0 ]] && exit 1
            range="-${1#--number=}::-1"
            shift
        ;;
        -p | --print)
            print=true
            shift
        ;;
        -r)
            shift
            range=$1
            shift
        ;;
        --range=*)
            range=${1#--range=}
            shift
        ;;
        *)
            break
        ;;
    esac
done

do_it() {
    for entry in $(diary-range -r "$range"); do
        diary-format -m "$entry"
    done
}

# If print then print to standard output if not print then use less.
if [[ "$print" ]]; then 
    do_it
else
    do_it | less -R
fi
